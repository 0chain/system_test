name: "0Chain System Tests"

env:
  DEFAULT_TAG: staging
  DEFAULT_ZWALLET_BRANCH: staging
  DEFAULT_ZBOX_BRANCH: staging

on:
  push:
  workflow_dispatch:
    inputs:
      test_run_description:
        description: '(OPTIONAL) Add a description/label for this test run. This will allow you to differentiate between test runs later'
        default: ''
        required: false
      zbox_cli_branch:
        description: '0Box CLI (branch or commit SHA) which the tests will use'
        default: 'staging'
        required: true
      zwallet_cli_branch:
        description: '0Wallet CLI (branch or commit SHA) which the tests will use'
        default: 'staging'
        required: true
      existing_network:
        description: '(OPTIONAL): EXISTING NETWORK to run system tests against INSTEAD OF DEPLOYING A NEW NETWORK. [example: dev.0chain.net]'
        default: ''
        required: false
      miner_image:
        description: 'miner DOCKER IMAGE to deploy'
        default: 'staging'
        required: false
      sharder_image:
        description: 'sharder DOCKER IMAGE to deploy'
        default: 'staging'
        required: false
      blobber_image:
        description: 'blobber DOCKER IMAGE to deploy'
        default: 'staging'
        required: false
      validator_image:
        description: 'validator DOCKER IMAGE to deploy'
        default: 'staging'
        required: false
      zbox_image:
        description: '0box DOCKER IMAGE to deploy'
        default: 'staging'
        required: false
      zblock_image:
        description: '0block DOCKER IMAGE to deploy'
        default: 'staging'
        required: false

jobs:
  golangci:
    if: github.event_name == 'push'
    name: "lint"
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v2
      - name: golangci-lint
        uses: golangci/golangci-lint-action@v2
        with:
          version: v1.42
          skip-build-cache: true
          skip-pkg-cache: true
          only-new-issues: true

  system-tests:
    name: "System Tests"
    runs-on: [ tests-suite ]
    timeout-minutes: 40
    steps:
      - name: "System tests"
        uses: 0chain/system_test@feature/composite-action
